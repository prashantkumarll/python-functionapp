on:
  push:
    branches:
    - main
  

# Deploy to an app on the Flex Consumption plan using OIDC authentication
jobs:
    build:
      runs-on: ubuntu-latest
      environment: Dev
      permissions:
          id-token: write # Required for OIDC
          contents: read # Required for actions/checkout
      steps: 
        # ...checkout your repository
        # ...required build steps for your language
        # ...upload your build artifact
    
    deploy:
      runs-on: ubuntu-latest
      needs: build
      permissions:
          id-token: write # Required for OIDC
      steps:
        # ...download your build artifact

        - name: 'Log in to Azure with AZ CLI'
          uses: azure/login@v2
          with:
            client-id: ${{ secrets.AZURE_CLIENT_ID }} # Required to log in with OIDC
            tenant-id: ${{ secrets.AZURE_TENANT_ID }} # Required to log in with OIDC
            subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }} # Required to log in with OIDC
          
        - name: 'Run the Azure Functions action'
          uses: Azure/functions-action@v1
          id: deploy-to-function-app
          with:
            app-name: ${{ env.AZURE_FUNCTIONAPP_NAME }}
            package: '${{ env.AZURE_FUNCTIONAPP_PROJECT_PATH }}'   